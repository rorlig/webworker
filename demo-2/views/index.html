<!-- working demo of google maps and webworker and socket io --> 
<html>
<head>
	<title>
			Google Maps, Webworker, Node.js and socket io
	</title>
	 <style type="text/css">
      html { height: 100% }
      body { height: 100%; margin: 0; padding: 0 }
      #map-canvas { height: 100% }
    </style>

    <!-- load google maps -->
     <script type="text/javascript"
      	src="https://maps.googleapis.com/maps/api/js?sensor=false">
     </script>

     <script src="/socket.io/socket.io.js"></script>


   

     <!-- initialize the google map -->
      <script type="text/javascript">
      	   var map;
      	   var typeIdChangeListener;
	      function initialize() {
	        var mapOptions = {
	          center: new google.maps.LatLng(-34.397, 150.644),
	          zoom: 8,
	          mapTypeId: google.maps.MapTypeId.TERRAIN
	        };
	        map = new google.maps.Map(document.getElementById("map-canvas"),
	            mapOptions);

		     

	          <!-- google maps events -->
	  		  <!-- zoom -->
	  		    google.maps.event.addListener(map, 'idle', function() {
			  	 // worker.postMessage({'cmd': 'dragend'});
			  	 socket.emit('map_event', { zoom: map.getZoom(), lat: map.getCenter().lat(), lng: map.getCenter().lng(), type: map.getMapTypeId() });

			  	 //socket.emit('my other event', { my: 'dragend' });

				    
			  });

	  		  typeIdChangeListener =  google.maps.event.addListener(map, 'maptypeid_changed', function() {
	  		   	console.log('maptypeid_changed');
			  	 // worker.postMessage({'cmd': 'dragend'});
			  	 socket.emit('map_event', { zoom: map.getZoom(), lat: map.getCenter().lat(), lng: map.getCenter().lng(), type: map.getMapTypeId() });

			  	 //socket.emit('my other event', { my: 'dragend' });

				    
			  });

	  		    
	  		//   google.maps.event.addListener(map, 'zoom_changed', function() {

	  		//   	 // worker.postMessage({'cmd': 'zoom_changed'});
			  // 	 socket.emit('map_event', { zoom: map.getZoom(), lat: map.getCenter().lat(), lng: map.getCenter().lng() });

				    
			  // });

			  // google.maps.event.addListener(map, 'dragstart', function() {
			  // 	 // worker.postMessage({'cmd': 'dragstart'});
			  // 	 socket.emit('map_event', { zoom: map.getZoom(), lat: map.getCenter().lat(), lng: map.getCenter().lng() });

			  //    // socket.emit('my other event', { my: 'dragstart' });

				    
			  // });

			  // google.maps.event.addListener(map, 'dragend', function() {
			  // 	 // worker.postMessage({'cmd': 'dragend'});
			  // 	 socket.emit('map_event', { zoom: map.getZoom(), lat: map.getCenter().lat(), lng: map.getCenter().lng() });

			  // 	 //socket.emit('my other event', { my: 'dragend' });

				    
			  // });
	      }
	      google.maps.event.addDomListener(window, 'load', initialize);

		// <!-- initialize the webworker --> 
	 //    var worker = new Worker('../js/doWork.js');

	 //    <!-- listener for callbacks from worker -->
	 //    worker.addEventListener('message', function(e) {
	 //    	console.log('worker message: ' + e.data);
	 //   	}, false);


		var socket = io.connect('http://107.21.207.8:8090/');
		  socket.on('news', function (data) {
		    console.log(data);
		    socket.emit('my other event', { my: 'data' });
		  });

		   socket.on('map_event', function (data) {
		    console.log("map_event received: " + data);
		   map.setCenter(new google.maps.LatLng(data.lat, data.lng));
		   map.setZoom(data.zoom);
		   google.maps.event.removeListener(typeIdChangeListener);

		   map.setMapTypeId(data.type);

		  typeIdChangeListener =   google.maps.event.addListener(map, 'maptypeid_changed', function() {
	  		   	console.log('maptypeid_changed');
			  	 // worker.postMessage({'cmd': 'dragend'});
			  	 socket.emit('map_event', { zoom: map.getZoom(), lat: map.getCenter().lat(), lng: map.getCenter().lng(), type: map.getMapTypeId() });

			  	 //socket.emit('my other event', { my: 'dragend' });

				    
			  });
		    // socket.emit('my other event', { my: 'data' });
		  });


	    /* websockets */
	 //   	var connection = new WebSocket('ws://html5rocks.websocket.org/echo', ['soap', 'xmpp']);

	 //   	connection.onopen = function () {
		//   connection.send('Ping'); // Send the message 'Ping' to the server
		// };

		// // Log errors
		// connection.onerror = function (error) {
		//   console.log('WebSocket Error ' + error);
		// };

		// // Log messages from the server
		// connection.onmessage = function (e) {
		//   console.log('Message from the server: ' + e.data);
		// };

		// Sending String



 
 
  		  




	  </script>
	  <script>
		  
	  </script>

</head>
<body>
	<div id="map-canvas">
	</div>
</body>
</html>